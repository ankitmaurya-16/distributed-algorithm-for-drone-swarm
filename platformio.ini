; PlatformIO Project Configuration File for Drone Swarm Project

; Build options: build flags, source filter
; Upload options: custom upload port, speed and extra flags
; Library options: dependencies, extra library storages
; Advanced options: extra scripting

[platformio]
default_envs = drone_1
src_dir = src
lib_dir = libraries
include_dir = src/main
test_dir = tests
data_dir = config

; For common setting of all the esp
[env]
platform = espressif32
framework = arduino
board = esp32dev
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Complier setting for every esp
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DARDUINO_RUNNING_CORE=1
    -DARDUINO_EVENT_RUNNING_CORE=1
    -Isrc/main
    -Isrc/algorithms
    -Isrc/communication
    -Isrc/coordination
    -Isrc/target_detection
    -Isrc/integration
    -Isrc/utilities

; Library dependencies
lib_deps = 
    sandeepmistry/LoRa@^0.8.0
    bblanchon/ArduinoJson@^6.21.3
    adafruit/Adafruit Unified Sensor@^1.1.9
    adafruit/Adafruit BMP280 Library@^2.6.8
    mikalhart/TinyGPSPlus@^1.0.3

; Custom library paths
lib_extra_dirs = 
    libraries/DroneProtocols
    libraries/external

; Upload settings
upload_speed = 921600
upload_port = auto

; Monitor settings
monitor_echo = yes
monitor_eol = LF

; Test settings
test_speed = 115200
test_port = auto

; Esp configuration

[env:drone_1]
build_flags = 
    ${env.build_flags}
    -DDRONE_ID=1
    -DLORA_FREQUENCY=433E6
    -DLORA_SYNC_WORD=0xF1
upload_port = COM3

[env:drone_2]
build_flags = 
    ${env.build_flags}
    -DDRONE_ID=2
    -DLORA_FREQUENCY=433E6
    -DLORA_SYNC_WORD=0xF2
upload_port = COM4

[env:drone_3]
build_flags = 
    ${env.build_flags}
    -DDRONE_ID=3
    -DLORA_FREQUENCY=433E6
    -DLORA_SYNC_WORD=0xF3
upload_port = COM5

[env:drone_4]
build_flags = 
    ${env.build_flags}
    -DDRONE_ID=4
    -DLORA_FREQUENCY=433E6
    -DLORA_SYNC_WORD=0xF4
upload_port = COM6

[env:drone_5]
build_flags = 
    ${env.build_flags}
    -DDRONE_ID=5
    -DLORA_FREQUENCY=433E6
    -DLORA_SYNC_WORD=0xF5
upload_port = COM7

; Testing environment

[env:test_simulation]
build_flags = 
    ${env.build_flags}
    -DSIMULATION_MODE=1
    -DDRONE_ID=1
    -DUNIT_TEST=1

[env:debug_monitor]
build_flags = 
    ${env.build_flags}
    -DDEBUG_MODE=1
    -DVERBOSE_LOGGING=1
    -DDRONE_ID=1

; Performance testing

[env:performance_test]
board = esp32-s3-devkitc-1
build_flags = 
    ${env.build_flags}
    -DPERFORMANCE_TEST=1
    -DBENCHMARK_MODE=1
    -DDRONE_ID=1
    -O3  

; Development environment

[env:dev_single_algorithm]
build_flags = 
    ${env.build_flags}
    -DSINGLE_ALGORITHM_TEST=1
    -DTEST_HEARTBEAT_ONLY=1  ; Should be changed for different algos
    -DDRONE_ID=1

; Build scripts (custom)
extra_scripts = 
    pre:tools/deployment/pre_build.py
    post:tools/deployment/post_build.py